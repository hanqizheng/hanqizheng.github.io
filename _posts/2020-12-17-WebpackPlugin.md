---
layout: post
title: "ç”¨WebpackæŠŠ2020æ‰“åŒ…"
author: "Qizheng Han"
---

èŠœæ¹–ï¼ï¼ï¼è¿™æ˜¯ 2020 å¹´çš„æœ€åä¸€ç¯‡åšå®¢å•¦ï¼åŒ dan å¿«ä¹ï½ ğŸ„ğŸ„ã€‚

è¿™æ˜¯ä¸€ç¯‡åŠå…¶å…¥é—¨çº§åˆ«çš„å…³äº webpack çš„åšå®¢ï¼Œæ‰€ä»¥å†™èµ·æ¥ä¼šæŠŠå¾ˆåŸºç¡€çš„ç»†èŠ‚ä¹Ÿéƒ½å†™ä¸€ä¸‹ï¼Œäº‰å–æ¯ä¸€æ­¥éƒ½å¼„æ˜ç™½ä¸ºä»€ä¹ˆï¼Œä¸€æ­¥ä¸€æ­¥æ¥ã€‚ä¹Ÿç¡®å®è¯¥è¡¥è¡¥è¿™ä¸€å—çš„çŸ¥è¯†ç›²åŒºäº†...ä¸è¦å¸¦åˆ°æ–°çš„ä¸€å¹´å“ˆå“ˆå“ˆã€‚

> å› ä¸ºæ˜¯åˆå­¦ï¼Œæ–‡ä¸­æœ‰é”™è¯¯æ¬¢è¿æŒ‡æ­£ï¼

# æˆ‘çœŸçš„å¾ˆæƒ³çŸ¥é“`webpackåˆ°åº•åšäº†äº›ä»€ä¹ˆ`ï¼Ÿ

ä½ é—®æˆ‘å¬è¯´è¿‡ webpack å—ï¼Ÿæˆ‘è‚¯å®šä¼šå›ç­”ï¼šâ€œå•Š webpackï¼Œå¬è¯´è¿‡ï¼Œå°±æ˜¯é‚£ä¸ª`æ‰“åŒ…ç”¨çš„`ã€‚â€œ

å…¶å®å†…å¿ƒæ…Œçš„ä¸€ pï¼Œ`æ‰“åŒ…ï¼Ÿ`æ‰“ä»€ä¹ˆåŒ…ï¼Ÿä»€ä¹ˆæ‰“åŒ…ï¼Ÿä¸ºä»€ä¹ˆè¦æ‰“åŒ…ï¼Œæ‰“åŒ…æ„ä¹‰ä½•åœ¨ï¼Ÿï¼ï¼Ÿï¼

## è¦ä»ä»€ä¹ˆæ˜¯ webpack è¯´èµ·

> webpack å®˜ç½‘ç»™å‡ºçš„å®šä¹‰:
>
> webpack is a `static module bundler` for modern JavaScript applications. When webpack processes your application, it internally builds a dependency graph which maps every module your project needs and generates one or more bundles.

å¤§æ¦‚çš„æ„æ€ï¼š

webpack æ˜¯ä¸€ä¸ªç”¨äºç°ä»£ JavaScript åº”ç”¨ç¨‹åºçš„`é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·`ã€‚å½“ webpack å¤„ç†åº”ç”¨ç¨‹åºæ—¶ï¼Œå®ƒä¼šåœ¨å†…éƒ¨æ„å»ºä¸€ä¸ª ä¾èµ–å›¾(dependency graph)ï¼Œæ­¤ä¾èµ–å›¾å¯¹åº”æ˜ å°„åˆ°é¡¹ç›®æ‰€éœ€çš„æ¯ä¸ªæ¨¡å—ï¼Œå¹¶ç”Ÿæˆä¸€ä¸ªæˆ–å¤šä¸ª bundleã€‚

èƒ½ä»è¿™ä¸ªå®šä¹‰ä¸­å¾—çŸ¥é“ä¸¤ä¸ªä¿¡æ¯

- åˆæ¥äº†ã€‚ã€‚ã€‚webpack æ˜¯ä¸€ä¸ª`é™æ€æ¨¡å—æ‰“åŒ…å·¥å…·`ã€‚
- ä¼šåœ¨å¤„ç†æ—¶æ„å»ºä¸€ä¸ª`ä¾èµ–å›¾(dependency graph)`ã€‚

ä½†æ˜¯è²Œä¼¼åˆå›åˆ°äº†é‚£ä¸ªæœ€åˆçš„é—®é¢˜ï¼Ÿä¸ºä»€ä¹ˆéœ€è¦ webpack å»æ‰“åŒ…è¿™äº›é™æ€èµ„æºï¼Ÿ

## ä¸ºä»€ä¹ˆéœ€è¦ webpack å»æ‰“åŒ…ä¸€äº›ä¸œè¥¿ï¼Ÿï¼Ÿ

ä¸Šé¢è¯´åˆ° webpack æ˜¯ä¸€ä¸ª`bundler`ï¼Œ*ä¸ºä»€ä¹ˆéœ€è¦ webpack*è¿™ä¸ªé—®é¢˜å°±å˜æˆäº†*ä¸ºä»€ä¹ˆæˆ‘éœ€è¦ç”¨ bundler*ã€‚

å†™ä¸€ä¸ª`hello, world!`å¯èƒ½åªéœ€è¦å‡ è¡Œä»£ç ï¼Œä½†æ˜¯å¦‚æœæˆ‘çš„åŠŸèƒ½å¾ˆå¤æ‚ï¼Œè¿™æ—¶å€™éœ€è¦çš„ JS ä»£ç å¯èƒ½æœ‰ 500 è¡Œã€‚è¿™æ—¶å€™è¿˜æ˜¯å‹‰å¼ºç¬‘ä¸€ç¬‘`æ²¡äº‹ï¼Œ500è¡Œä»£ç å¯ä»¥æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶é‡Œ`(å¾®ç¬‘.jpg)ã€‚

æ²¡æƒ³åˆ°å†™çš„ä»£ç æœ‰å¾ˆå¤šå°ä¼™ä¼´éƒ½è®¤çœŸç ”è¯»ï¼Œè‡ªå·±åšå‡ºæ¥çš„ä¸œè¥¿çœŸçš„æœ‰å¾ˆå¤šç”¨æˆ·äº†ã€‚ä½†æ˜¯æœŸé—´å‘ç°äº†è®¸å¤š bugï¼Œè¿˜æœ‰å¾ˆå¤šäººæå‡ºäº†ä¸€äº›ä»–ä»¬æƒ³è¦çš„ featureã€‚

ä¿®ä¿®è¡¥è¡¥ï¼Œåˆæ·»åŠ æ›´å¤šçš„åŠŸèƒ½ã€‚çœ¼çœ‹ç€ 500 è¡Œçš„ä»£ç å˜æˆ 1w è¡Œäº†ã€‚è¿™æ—¶å€™åœ¨å¼€å‘çš„æ—¶å€™çªç„¶å¤§å–Šäº†ä¸€å¥`å§æ§½...`

å¯èƒ½æ‰¾ä¸€ä¸ªå˜é‡è¦ç¿» 2000 è¡Œçš„ä»£ç ï¼Œä¸€ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„éƒ½è¦ç ”ç©¶å¥½ä¹…ï¼Œè¿™æ—¶å€™ç»ˆäºå¿ä¸ä½äº†ï¼Œ`è¦æŠŠè¿™ä¹ˆå¤§çš„ä¸€ä¸ªæ–‡ä»¶æ‹†åˆ†ä¸€ä¸‹ï¼Œæ ¹æ®åŠŸèƒ½æ‹†åˆ†æˆè‹¥å¹²å°æ–‡ä»¶ã€‚`

`code spliting`çš„è¿‡ç¨‹è®©æˆ‘æ„Ÿåˆ°èˆ’é€‚ï¼ŒåŸæ¥æˆ‘çš„ä»£ç å¯ä»¥å˜å¾—è¿™ä¹ˆæ•´æ´æœ‰åºï¼Œå¼ºè¿«ç—‡è¢«æ²»æ„ˆã€‚

**ä½†è¿™ä¸ªæ—¶å€™è¦å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘è¿˜æ²¡æœ‰æ¨¡å—åŒ–è¿™ä¸€è¯´ã€‚**æˆ‘åªæ˜¯å•çº¯çš„æ‹†åˆ†äº†è‡ªå·±çš„ä»£ç ã€‚é‚£äº›è¢«æ‹†åˆ†å¥½çš„ä¸€ä¸ªä¸ª`.js`æ–‡ä»¶è¯¥ä»¥ä¸€ç§ä»€ä¹ˆé¡ºåºå»è¢«å¼•ç”¨åˆ°`æœ€ç»ˆçš„æŸä¸€ä¸ªæ–‡ä»¶(æˆ‘å°±ä»¥ä¸€ä¸ªæ€»çš„htmlå¼•ç”¨å…¶ä»–æ‹†åˆ†å¥½çš„jsä¸ºæƒ³è±¡æ¡ˆä¾‹)`å‘¢ï¼Ÿ

æ¯”å¦‚è¿™é‡Œæˆ‘ä»¥ä¸€ä¸ªhtmlé‡çš„`<script></script>`æ ‡ç­¾åŒ…å«çš„`jsä»£ç `æ¥ä¸¾ä¾‹ï¼Œå½“æˆ‘ä»¬æœ‰2000è¡Œä»£ç çš„æ—¶å€™ï¼Œæˆ‘ä»¬å‘ç°`ä¸èƒ½å†æŠŠä»£ç å¯¹åœ¨ä¸€ä¸ªæ–‡ä»¶`ã€‚è¿™æ—¶å€™æˆ‘ä»¬å¼€å§‹åš`code spliting`ï¼Œç„¶ååˆ†æˆ`20ä¸ªjsæ–‡ä»¶`ã€‚

è¿™ä¸ªæ—¶å€™å°±é‡åˆ°é—®é¢˜äº†ã€‚æˆ‘ä»¬è¦åœ¨æœ€ç»ˆçš„`index.html`ä¸­å†™`20ä¸ª<script></script>`æ¥åŒ…å«è¿™äº›è¢«ä»£ç åˆ†å‰²åçš„`js`ã€‚ä½†æ˜¯æˆ‘ä»¬`è¯¥æ€ä¹ˆå»ç»´æŠ¤`è¿™äº›ä»£ç ä¹‹é—´çš„`æ‰§è¡Œé¡ºåº`ï¼Ÿ

ä¿è¯è°å…ˆæ‰§è¡Œï¼Œè°åæ‰§è¡Œæ˜¯ä¸€ä»¶å¾ˆå…³é”®çš„äº‹ã€‚

è¿™æ—¶å€™å¯èƒ½ä¼šè¯´`é‚£æˆ‘æŒ‰é¡ºåºå†™å¥½è¿™20ä¸ªscriptæ ‡ç­¾`ä¸å°±å¥½äº†å—ï¼Ÿ

ä½†æ˜¯æˆ‘è¦æ˜¯æ—¥åå†éœ€è¦æ‰©å±•ä»£ç å‘¢ï¼Ÿæˆ‘è¿˜éœ€è¦å»`è€ƒè™‘æ–°ä»£ç å’Œå…¶ä»–å·²æœ‰ä»£ç çš„ç›¸äº’é¡ºåº`ã€‚æ˜¯ä¸€ä¸ªéå¸¸éº»çƒ¦ä¸”ä¸å¥½ç»´æŠ¤çš„äº‹æƒ…ã€‚

### è¦æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸€ç§ä¾èµ–å…³ç³»ï¼Œå‘Šè¯‰æˆ‘æŸä¸ªæ–‡ä»¶ä¾èµ–ç€å¦å¤–å“ªäº›æ–‡ä»¶ï¼Œè¿™æ ·æˆ‘å°±å¯ä»¥çŸ¥é“å¼•ç”¨çš„é¡ºåºäº†ã€‚

`This is where webpack steps in.`

## ES6 or CommonJS å¸¦æ¥çš„è½¬æŠ˜

ES6çš„`import`å’ŒCommonJSçš„`require`å¸¦æ¥äº†æ¨¡å—åŒ–çš„æ¦‚å¿µï¼Œä¹Ÿéšä¹‹æœ‰äº†æˆ‘ä»¬æƒ³è¦çš„é‚£ç§æ–‡ä»¶ä¸æ–‡ä»¶ä¹‹é—´çš„å¼•ç”¨å…³ç³»ã€‚

webpacklå°±å€ŸåŠ©ä»–ä»¬æ¥ç”Ÿæˆä¾èµ–å…³ç³»ã€‚éšä¹‹å°†ä»–ä»¬æ‰“åŒ…åˆ°ä¸€èµ·è¿˜èƒ½ä¿è¯å…¶æ‰§è¡Œçš„é¡ºåºã€‚

## æ€»ç»“ä¸€ä¸‹

ä»£ç å¤ªå¤šäº†ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»£ç æŒ‰ç…§æŸç§çº¦å®šåˆ†å‰²ï¼Œè¿™æ ·å¥½æ‰©å±•ä¹Ÿå¥½ç»´æŠ¤ï¼Œä½†æ˜¯å†™å¥½çš„ä»£ç æˆ‘ä»¬å…¶å®å¸Œæœ›ä»–æœ€ç»ˆæ˜¯æ•´åˆåœ¨ä¸€èµ·çš„ï¼Œè¿™æ—¶å€™æˆ‘ä»¬`éœ€è¦æŠŠä¸€ä¸ªé¡¹ç›®æ‰“åŒ…`ï¼Œä½†æ˜¯æˆ‘ä»¬æƒ³æ‰“åŒ…ä¹‹åçš„æ–‡ä»¶è¿˜èƒ½ç¡®ä¿è¢«åˆ†å‰²çš„ä»£ç æŒ‰ç…§è§„å®šçš„é¡ºåºæ‰§è¡Œ(æˆ–è€…è¯´æ­£å¸¸æ‰§è¡Œ)ã€‚è€Œwebpackå¯ä»¥æ ¹æ®`æ¨¡å—åŒ–`çš„è§„å®šæ¥ç”Ÿæˆ`dependency graph`æ¥ç¡®ä¿è¿™ä¸€ç‚¹ã€‚

## æ¥ä¸‹æ¥æ‰¾ç‚¹ä¸œè¥¿æ¥æ‰“åŒ…

```
$ mkdir webpack-test

$ cd webpack-test

$ npm init

$ npm install webpack webpack-cli --save-dev
```

> æ³¨æ„ è¿™é‡Œçš„ webpack è¿˜æ˜¯æ ‡è®°å¥½ç‰ˆæœ¬ï¼Œ4.44.2

å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œåˆå§‹åŒ–ä¸€ä¸‹ï¼Œä¸€è·¯é»˜è®¤é€‰é¡¹è¿™æ ·å°±æœ‰äº†ä¸€ä¸ªç©ºé¡¹ç›®äº†ã€‚è€Œä¸”è¦ç”¨åˆ° webpackï¼Œæ‰€ä»¥è‡ªç„¶å…ˆè¦ install ä¸€ä¸‹ã€‚

`é¡¹ç›®ç©ºç©ºå¦‚ä¹Ÿ`ï¼Œæˆ‘ä»¬éšä¾¿ç»™ä»–å¡ç‚¹ä¸œè¥¿ï¼Œæœ‰ä¸œè¥¿æ‰èƒ½æ‰“åŒ…ã€‚

```
// æ–°å»ºä¸€ä¸ªsrc
|- other folder
|- ...
|- src
    |
    |- page1
    |    |- index.js
    |- page2
    |    |-index.js
    |- index.js
```

æ–°å»ºä¸€ä¸ª`src`æ–‡ä»¶å¤¹ï¼Œè§£æ„æ˜¯è¿™ä¸ªæ ·å­ã€‚æˆ‘å¤šå»ºä¸¤ä¸ª`page`æ–‡ä»¶å¤¹æ˜¯åç»­ä¼šç”¨åˆ°ã€‚

éšä¾¿ç»™è¿™äº›æ–‡ä»¶å†™ç‚¹ä¸œè¥¿ã€‚

å†™åˆ°è¿™é‡Œçªç„¶æƒ³å†™`React`ï¼Œæ¯•ç«Ÿæ¥ç‚¹èƒ½çœ‹åˆ°çš„ä¼šæ›´ç›´è§‚ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—æŠŠ React éœ€è¦çš„ä¸œè¥¿å†å‡†å¤‡ä¸€ä¸‹ã€‚

```
$ npm install react react-dom --save
```

ç„¶åæˆ‘ä»¬çŸ¥é“ React æœ€åä¼šæŠŠå¯¹åº”çš„`jsxå˜æˆè™šæ‹ŸDOMæ ‘`ï¼Œæœ€åå†æ’å…¥åˆ°çœŸçš„ DOM æ ‘ä¸­ï¼Œä¹Ÿå°±æ˜¯æ ¹ç»“ç‚¹`root`é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬å¾—æœ‰ä¸€ä¸ª`html`æ”¾è¿™æ£µ`DOMæ ‘`ã€‚

æˆ‘ç›´æ¥å¤åˆ¶çš„

```html
<!-- public/index.html -->

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <title>React App</title>
  </head>
  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <div id="root"></div>
  </body>
</html>
```

ç›®å½•ç»“æ„å˜æˆ

```
|- ...
|- src
|   |- ...
|
|- public
    |- index.html
```

ç„¶åæˆ‘ä»¬éœ€è¦

```jsx
// src/index.js

{% raw %}
import React from 'react';
import ReactDOM from 'react-dom';

import Page1 from './page1/index.jsx';

ReactDOM.render(
  <Page1 />,
  document.getElementById('root')
);
{% endraw %}
```

æ—¢ç„¶è¦æ¸²æŸ“`Page1`ï¼Œæˆ‘ä»¬å»å¾€`Page1`ä¸­å†™ç‚¹ä¸œè¥¿ã€‚

```jsx
// src/page1/index.jsx

{% raw %}
import React from 'react';

const Page1 = () => {
  return (
    <div>
      Page 1
    </div>
  )
}

export default Page1;
{% endraw %}
```

è¿™ä¸ªæ—¶å€™å¯ä»¥çœ‹åˆ°é¡¹ç›®å·²ç»è·‘èµ·æ¥äº†

![](/assets/img/2020-12-28/init.jpg)

## è¿«ä¸åŠå¾…çš„æƒ³æ‰“åŒ…ä¸€ä¸‹

```
$ webpack --mode=development
```

`--mode=development`æ˜¯ä¸ºäº†èƒ½æ›´å¥½çš„çœ‹åˆ°æ‰“åŒ…åçš„ä»£ç ï¼Œä½†æ˜¯æˆ‘å´çœ‹åˆ°äº†ä¸€ç‰‡çº¢å…‰ ğŸ¤¦â€â™‚ï¸...

![](/assets/img/2020-12-28/webpackError.jpg)

`webpack`è¯´å®ƒä¸è®¤è¯†ä½ è¿™ç§å¥‡æ€ªçš„å†™æ³•(æˆ‘æ˜¯æŒ‡ JSX)ã€‚`Yuo may need an apropriate loader to handle this file.`

## æˆ‘éœ€è¦`loader`

éœ€è¦çš„ç¬¬ä¸€ä¸ª`loader`å°±æ˜¯`babel-loader`ï¼Œ Babel æ˜¯ä¸€ä¸ª JS ç¼–è¯‘å™¨ã€‚å¯ä»¥åœ¨åç»­çš„åšå®¢ä¸­ä¸€èµ·å­¦ä¹ ä¸€ä¸‹(æˆ‘å·²ç»æ¬ äº†å¤šå°‘ç¯‡äº†å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆ)ã€‚

```
$ npm install babel-loader --save-dev

// è¿˜éœ€è¦å®‰è£…ä¸€ä¸‹babelï¼Œå…‰å®‰è£…babelå¯¹åº”çš„loaderæ˜¾ç„¶æ˜¯ä¸è¡Œçš„ï¼ŒçœŸæ­£ç¼–è¯‘jsxçš„ä»£ç è¿˜æ˜¯è¦babelå»åš

$ npm install @babel/core @babel/preset-env @babel/plugin-transform-runtime -save-dev

$ npm install @babel/runtime @babel/runtime-corejs3
```

ç„¶åå»åˆ›å»ºä¸€ä¸ª webpack çš„é…ç½®æ–‡ä»¶

```
// åˆ›å»ºä¸€ä¸ªwebpackçš„é…ç½®æ–‡ä»¶

|- ...
|- src
|   |- ...
|
|- public
|   |- ...
|
|- webpackc.config.js
```

è¿™ä¸ªé…ç½®æ–‡ä»¶å°±æ˜¯é…ç½® webpack æœ€é‡è¦çš„å‡ ä¸ªæ¦‚å¿µçš„æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆé…ç½® loaderã€‚

```js
module.exports = {
  // mode: 'development',
  entry: path.resolve(__dirname, './src/index.js'),
  output: {
    path: path.resolve(__dirname, './dist'),
    filename: 'bundle.js'
  },
  module: {
    rules: [
      {
        test: /\.jsx?$/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ["@babel/preset-env"]
          }
        },
        exclude: /node_modules/
      }
    ]
  }
}
```

è¿™ä¸ªæ—¶å€™é…ç½®å¥½ï¼Œè¿«ä¸åŠå¾…çš„æ•²ä¸‹`$ webpack --mode=development`ï¼Œç„¶è€Œ...

![](/assets/img/2020-12-28/stillError.jpg)

è¿™æ˜¯å› ä¸ºï¼Œæˆ‘é…ç½®äº†`webpack`å¯¹åº”`babel`çš„`loader`ï¼Œä½†æ˜¯ babel æœ¬èº«ä¹Ÿæ˜¯æœ‰ç›¸å…³é…ç½®çš„ï¼Œæˆ‘å¾—é…ç½®ä¸€ä¸‹ babelï¼Œ`è®©babelèƒ½è®¤è¯†jsx`ã€‚

> å†æ¬¡å£°æ˜ï¼Œæ—¥åæ¥ä¸€ç¯‡ babel çš„åšå®¢ã€‚

```js
// .babelrc

{ "presets": ["@babel/react", "@babel/env"] }
```

> è¯´å®è¯æˆ‘ä¸çŸ¥é“ä¸ºä»€ä¹ˆè¦é…ç½®è¿™ä¹ˆä¸€å¥è¯ï¼ŒæœŸå¾…æ—¥åçš„babelå­¦ä¹ ã€‚å¼ºé¢œæ¬¢ç¬‘.jpg

è¿™ä¸ªæ—¶å€™`å†æ¥build`ä¸€æ¬¡ã€‚å°±å¯ä»¥çœ‹åˆ°æ˜¯æˆåŠŸçš„äº†

![](/assets/img/2020-12-28/success.jpg)

## æœ‰ç‚¹ä¸å¯¹åŠ²å„¿ï¼Ÿ

æˆ‘ä»¬ä¹‹å‰è¯´ï¼Œæƒ³æŠŠè‡ªå·±çš„é¡¹ç›®`æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶`ï¼Œæˆ‘ä»¬ç¡®å®æŠŠè‡ªå·±æ‰€æœ‰çš„jséƒ½æ‰“åŒ…å¥½äº†ã€‚ä½†æ˜¯è¿™ä¸ªjsæ˜¯è¦ç”¨åœ¨æœ€åçš„`é‚£ä¸ªhtml`ä¸­çš„(åˆ†å‰²äº†å¥½å¤šä¸ªjsæ–‡ä»¶ï¼Œæœ€ç»ˆæ‰“åŒ…æˆä¸€ä¸ªjsåœ¨htmlä¸­ç”¨scriptæ ‡ç­¾å¼•ç”¨)ã€‚æˆ‘ä»¬è¿˜éœ€è¦æ¥ä¸€ä¸ª`html`å•Šï¼

## Loaderè¯´å®Œè¯´è¯´Plugin

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å·²ç»æ‰“åŒ…å¥½`bundle.js`äº†ï¼Œä½†æ˜¯æ¯æ¬¡æ‰“åŒ…éƒ½æœ‰`å”¯ä¸€çš„hash`ï¼Œæ¯æ¬¡æˆ‘ä»¬éƒ½å»è‡ªå·±å†™çš„htmlä¸­ä¿®æ”¹å¼•ç”¨çš„`jsæ–‡ä»¶çš„åå­—`ä¹Ÿå¤ªå‚»äº†ï¼Œè¿™æ—¶å€™å°±å¯ä»¥ç”¨`plugin`æ¥å¸®æˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```
$ npm install html-webpack-plugin --save-dev
```

ç„¶åæˆ‘ä»¬å»webpackçš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ pluginç›¸å…³çš„é…ç½®ã€‚

```js
const path = require('path');
//é¦–å…ˆå¼•å…¥æ’ä»¶
const HtmlWebpackPlugin = require('html-webpack-plugin');

module.exports = {
  // mode: 'development',
  // other config...
  plugins: [
    //æ•°ç»„ æ”¾ç€æ‰€æœ‰çš„webpackæ’ä»¶
    new HtmlWebpackPlugin({
      template: './public/index.html',
      filename: 'index.html', //æ‰“åŒ…åçš„æ–‡ä»¶å
      minify: {
        removeAttributeQuotes: false, //æ˜¯å¦åˆ é™¤å±æ€§çš„åŒå¼•å·
        collapseWhitespace: false, //æ˜¯å¦æŠ˜å ç©ºç™½
      },
      // hash: true //æ˜¯å¦åŠ ä¸Šhashï¼Œé»˜è®¤æ˜¯ false
    })
  ]
}
```

å†æ¥æ‰“åŒ…ä¸€éï¼Œå¯ä»¥çœ‹åˆ°`dist`ä¸‹å¤šäº†ä¸€ä¸ª`index.html`ã€‚

![](/assets/img/2020-12-28/distIndex.jpg)

## htmlæœ‰äº†å¯æ˜¯å’‹çœ‹æ•ˆæœå•Šï¼Ÿ

æˆ‘ä»¬åœ¨æœ€å¼€å§‹ï¼Œ`æ²¡æœ‰webpack`çš„æ—¶å€™ï¼Œè¿è¡Œ`npm run start`å…¶å®å°±æ˜¯è¿è¡Œ`react-scripts start`æ¥å¯åŠ¨é¡¹ç›®æŸ¥çœ‹æ•ˆæœã€‚

ç°åœ¨æˆ‘ä»¬æŠŠè‡ªå·±å†™çš„demoå·²ç»é€šè¿‡webpackæ‰“åŒ…å¥½äº†ï¼Œåªæœ‰ä¸€ä¸ªjså’Œä¸€ä¸ªhtmlã€‚ä½†æ˜¯æˆ‘ä»¬è¦æ€ä¹ˆæŸ¥çœ‹æ‰“åŒ…åçš„ä»£ç æ•ˆæœå‘¢ï¼Ÿ`æœ€å¥½å’Œä¹‹å‰æ•ˆæœä¸€æ ·`ã€‚

```json
"scripts": {
  // ...
  "dev": "NODE_ENV=development webpack serve",
},
```

ä¹‹å‰è¿˜è£…äº†`webpack-dev-server`ç„¶è€Œå‘ç°`4.x`ç‰ˆæœ¬è²Œä¼¼ä¸éœ€è¦ï¼Œç›´æ¥`webpack serve`å³å¯ã€‚

![](/assets/img/2020-12-28/serve.jpg)
![](/assets/img/2020-12-28/servePage.jpg)

å¯ä»¥çœ‹åˆ°æ•ˆæœå’Œä¹‹å‰ä¸€æ ·ã€‚
## è¯´å¥½çš„è¦æŠŠ2020æ‰“åŒ…çš„ ğŸ“¦

å“ˆå“ˆå“ˆå“ˆå•Šå“ˆå“ˆè®°å¾—è¿™ä¹ˆä¸€æ®µå¯¹è¯

> ä¸äº†è§£Webpack
>
> å†™ä¸€ä¸ªpluginå°±å·®ä¸å¤šäº†è§£äº†ã€‚

æ‰€ä»¥æˆ‘ä»¬æ¥ä¸‹æ¥å°±å†™ä¸€ä¸ª`èƒ½æŠŠ2020æ‰“åŒ…çš„Plugin`ã€‚è¿™ä¸ªpluginçš„åŠŸèƒ½å¾ˆç®€å•å¾ˆç®€å•ã€‚

æˆ‘å¯¹`Plugin`çš„ç†è§£å°±æ˜¯:

**Pluginå°±æ˜¯ä¸€ä¸ªfunctionï¼Œä¸€ä¸ªåŸå‹ä¸Šæœ‰ä¸€ä¸ªapplyæ–¹æ³•çš„functionã€‚**

æˆ‘ä»¬ä½¿ç”¨Plugin`å°±æ˜¯newä¸€ä¸ªå¯¹åº”çš„å¯¹è±¡`ï¼Œwebpackä¼šè‡ªåŠ¨è°ƒç”¨å¯¹è±¡çš„`apply()`æ–¹æ³•ã€‚

æ‰€ä»¥æˆ‘ä»¬å…ˆæ¥æ‰¾ä¸ªåœ°æ–¹å†™ä¸€ä¸ªæœ€ç®€å•çš„`ç¬¦åˆè¿™ä¸ªè§„åˆ™çš„class`ã€‚

```
// åˆ›å»ºä¸€ä¸ªplugin

|- ...
|- src
|   |- ...
|
|- public
|   |- ...
|
|- plugins
    |
    |- Pack2020Plugin.js
```

```js
// plugins/Pack2020Plugin.js

class Pack2020Plugin {
  apply() {
      console.log('I want to pack 2020!')
  }
}
module.exports = Pack2020Plugin;

// or

function Pack2020Plugin () {}

Pack2020Plugin.prototype.apply = function () {
  console.log('I want to pack 2020!')
}
module.exports = Pack2020Plugin;
```

## compiler & compilation

`compiler`å°±æ˜¯ä¸€ä¸ª`webpackçš„å®Œæ•´é…ç½®`ä»¥`å¯¹è±¡å½¢å¼`ä½œä¸º`å‚æ•°`ä¼ å…¥plugin`ã€‚

`compilation`æˆ‘ç†è§£æ˜¯ä¸€ä¸ª`å›è°ƒå‡½æ•°`...

## å…ˆæ¥çœ‹çœ‹æ•ˆæœ

```js
module.exports = {
  // mode: 'development',
  // ...
  plugins: [
    //æ•°ç»„ æ”¾ç€æ‰€æœ‰çš„webpackæ’ä»¶
    new HtmlWebpackPlugin({
      template: './public/index.html',
      filename: 'index.html', //æ‰“åŒ…åçš„æ–‡ä»¶å
      minify: {
        removeAttributeQuotes: false, //æ˜¯å¦åˆ é™¤å±æ€§çš„åŒå¼•å·
        collapseWhitespace: false, //æ˜¯å¦æŠ˜å ç©ºç™½
      },
      // hash: true //æ˜¯å¦åŠ ä¸Šhashï¼Œé»˜è®¤æ˜¯ false
    }),
    new Pack2020Plugin()
  ]
}
```

è¿è¡Œäº†`npm run dev`ä¹‹åå¯ä»¥çœ‹åˆ°å‘½ä»¤è¡Œä¸­å¤šäº†ä¸€è¡Œ

![](/assets/img/2020-12-28/pluginInit.jpg)

çœ‹æ¥æˆ‘çš„pluginèµ·ä½œç”¨äº†ã€‚

æ¥ä¸‹æ¥å®ç°ä¸€ä¸ª`æ‰“åŒ…ç”Ÿæˆä¸€ä¸ª2021è®¸æ„¿txtï¼Œé‡Œé¢è®°å½•äº†æˆ‘çš„ç¾å¥½ç¥ç¦ã€‚`

```js
class Pack2020Plugin {
  apply(compiler) {
    // emit é’©å­æ˜¯ç”Ÿæˆèµ„æºåˆ° output ç›®å½•ä¹‹å‰æ‰§è¡Œï¼Œemit æ˜¯ä¸€ä¸ªå¼‚æ­¥ä¸²è¡Œé’©å­ï¼Œéœ€è¦ç”¨ tapAsync æ¥æ³¨å†Œ
    compiler.hooks.emit.tapAsync('Pack2020Plugin', (compilation, callback) => {
      // å›è°ƒæ–¹å¼æ³¨å†Œå¼‚æ­¥é’©å­
      const hopeOf2021 = 'æŠŠ2020æ‰“åŒ…ï¼Œ2021ï¼Œè¦åŠªåŠ›åŠ æ²¹ï¼ï¼'
      // compilationå­˜æ”¾äº†è¿™æ¬¡æ‰“åŒ…çš„æ‰€æœ‰å†…å®¹
      // æ‰€æœ‰å¾…ç”Ÿæˆçš„æ–‡ä»¶éƒ½åœ¨å®ƒçš„ assets å±æ€§ä¸Š
      compilation.assets['hope.txt'] = {
        // æ·»åŠ copyright.txt
        source: function () {
          return hopeOf2021
        },
        size: function () {
          // æ–‡ä»¶å¤§å°
          return hopeOf2021.length
        },
      }
      callback() // å¿…é¡»è°ƒç”¨
    })
  }
}

module.exports = Pack2020Plugin;
```

å°±æ˜¯éå¸¸ç®€å•çš„ï¼Œè·å–åˆ°`ç”Ÿæˆèµ„æºåˆ° output ä¹‹å‰çš„æ—¶æœº`ï¼Œç„¶åæ‰§è¡Œã€‚

è¿™æ—¶å€™`npm run build`

![](/assets/img/2020-12-28/hope.jpg)

æˆ‘ç”šè‡³å¯ä»¥é€šè¿‡`config`ä¸­çš„plugin`ä¼ é€’å‚æ•°`è¿›å»ã€‚

```js
module.exports = {
  // mode: 'development',
  // ...
  plugins: [
    //æ•°ç»„ æ”¾ç€æ‰€æœ‰çš„webpackæ’ä»¶
    new HtmlWebpackPlugin({
      template: './public/index.html',
      filename: 'index.html', //æ‰“åŒ…åçš„æ–‡ä»¶å
      minify: {
        removeAttributeQuotes: false, //æ˜¯å¦åˆ é™¤å±æ€§çš„åŒå¼•å·
        collapseWhitespace: false, //æ˜¯å¦æŠ˜å ç©ºç™½
      },
      // hash: true //æ˜¯å¦åŠ ä¸Šhashï¼Œé»˜è®¤æ˜¯ false
    }),
    new Pack2020Plugin({ name: 'éŸ©å¯æ­£' })
  ]
}
```

ç„¶ååœ¨`Pluginå†…éƒ¨æ¥ä½å‚æ•°`ã€‚

```js
// æ”¹å˜Pac2020Pluginå†…éƒ¨ä»£ç 
{% raw %}
constructor(option) {
  this.name = option.name;
}

const hopeOf2021 = `æŠŠ2020æ‰“åŒ…ï¼Œ2021ï¼Œ${this.name}è¦åŠªåŠ›åŠ æ²¹ï¼ï¼`
{% endraw %}
```

ç„¶åå†`build`ä¸€æ¬¡ã€‚

![](/assets/img/2020-12-28/end.jpg)

è¿™æ ·å°±æ˜¯ä¸€ä¸ªéå¸¸éå¸¸ç®€å•çš„Pluginäº†ã€‚`å½“ç„¶è¿™åªæ˜¯éå¸¸å…¥é—¨çš„`ã€‚æƒ³è¦äº†è§£Pluginè¿˜æ˜¯è¦ç»§ç»­å­¦ä¹ webpackã€‚

## æ’æ›²

[é¡¹ç›®åœ°å€](https://github.com/hanqizheng/WebpackDemo)

2020ä¹Ÿæ˜¯æ»¡æ»¡æ”¶è·çš„ä¸€å¹´ï¼Œ2020å¹´è®°å³å°†å‘å¸ƒï½ 

ps: å…¶å®å°±æ˜¯æˆ‘è¿˜æ²¡å†™å®Œ...



# å‚è€ƒ

- [Webpack â€” why and what](https://medium.com/js-imaginea/webpack-why-and-what-4948433cc2d3)
- [Webpack: When To Use And Why](https://blog.andrewray.me/webpack-when-to-use-and-why/)
- [Why webpack](https://webpack.js.org/concepts/why-webpack/)
- [Webpack Concepts](https://webpack.js.org/concepts/)
- [å¸¦ä½ æ·±åº¦è§£é” Webpack ç³»åˆ—(åŸºç¡€ç¯‡)](https://juejin.cn/post/6844904079219490830)
- [å¸¦ä½ æ·±åº¦è§£é” Webpack ç³»åˆ—(è¿›é˜¶ç¯‡)](https://juejin.cn/post/6844904084927938567)
- [å¸¦ä½ æ·±åº¦è§£é” Webpack ç³»åˆ—(ä¼˜åŒ–ç¯‡)](https://juejin.cn/post/6844904093463347208)
- [ä¸å®¹é”™è¿‡çš„ Babel7 çŸ¥è¯†](https://juejin.cn/post/6844904008679686152)
- [å¦‚ä½•ç¼–å†™ä¸€ä¸ª Webpack Plugin](https://juejin.cn/post/6884866016565084173)
