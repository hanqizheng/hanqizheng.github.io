---
layout: post
title: "äº‹ä»¶æœºåˆ¶ä¸‰é¡¾"
author: "Qizheng Han"
---

å‰ç«¯æ”»åŸç‹®åœ¨â€œæ”»åŸâ€ä¹‹æ—¶å¾€å¾€æœ‰ä¸€åˆ©å™¨é‚£ä¾¿æ˜¯`äº‹ä»¶`ã€‚ 

æ­¤åˆ©å™¨éå¸¸äººæ‰€èƒ½ä¹ å¾—ä¹‹ç‰©ã€‚æ¬²ç²¾å…¶èº«ï¼Œå¿…å…ˆç²¾å…¶å†…ï¼Œæ˜å…¶ç›¸è¾…ç›¸æˆä¹‹é“ã€‚ 

å’³ï½è¿™ä¹ˆè¯´ä¸‹å»æˆ‘æ€•æ˜¯é©¬ä¸Šå°±èµ°åˆ°æ–‡åŒ–æ²™æ¼ äº†å“ˆå“ˆå“ˆã€‚ä»Šå¤©å‘¢ï¼Œå°±æ¥ç ”ç©¶ç ”ç©¶å‰ç«¯ä¹ƒè‡³Reactçš„äº‹ä»¶ç›¸å…³æœºåˆ¶ã€‚ 

# ä¸€é¡¾ï¼šDOMäº‹ä»¶æœºæµ

äº‹ä»¶æœºåˆ¶çš„å†å²è¦è¿½æº¯åˆ°1988å¹´äº†ã€‚

> W3Cåä¼šæ—©åœ¨1988å¹´å°±å¼€å§‹äº†DOMæ ‡å‡†çš„åˆ¶å®šï¼ŒW3C DOMæ ‡å‡†å¯ä»¥åˆ†ä¸º DOM1ã€DOM2ã€DOM3 ä¸‰ä¸ªç‰ˆæœ¬ã€‚
>
> ä» DOM2 å¼€å§‹ï¼ŒDOM çš„äº‹ä»¶ä¼ æ’­åˆ†ä¸‰ä¸ªé˜¶æ®µè¿›è¡Œï¼šäº‹ä»¶æ•è·é˜¶æ®µã€å¤„äºç›®æ ‡é˜¶æ®µå’Œäº‹ä»¶å†’æ³¡é˜¶æ®µã€‚

ä¸‹é¢ç»™å‡ºè¿™ä¸‰ä¸ªé˜¶æ®µçš„å¤§æ¦‚å®šä¹‰

![](/assets/img/2021-03-26/eventProgress.png)


- äº‹ä»¶æ•è·é˜¶æ®µï¼šäº‹ä»¶å¯¹è±¡é€šè¿‡ç›®æ ‡èŠ‚ç‚¹çš„ç¥–å…ˆ Window ä¼ æ’­åˆ°ç›®æ ‡çš„çˆ¶èŠ‚ç‚¹ã€‚

- å¤„äºç›®æ ‡é˜¶æ®µï¼šäº‹ä»¶å¯¹è±¡åˆ°è¾¾äº‹ä»¶ç›®æ ‡èŠ‚ç‚¹ã€‚å¦‚æœ`é˜»æ­¢äº‹ä»¶å†’æ³¡`ï¼Œé‚£ä¹ˆè¯¥äº‹ä»¶å¯¹è±¡`å°†åœ¨æ­¤é˜¶æ®µå®Œæˆååœæ­¢ä¼ æ’­`ã€‚

- äº‹ä»¶å†’æ³¡é˜¶æ®µï¼šäº‹ä»¶å¯¹è±¡ä»¥ç›¸åçš„é¡ºåºä»ç›®æ ‡èŠ‚ç‚¹çš„çˆ¶é¡¹å¼€å§‹ä¼ æ’­ï¼Œä»ç›®æ ‡èŠ‚ç‚¹çš„çˆ¶é¡¹å¼€å§‹åˆ° Window ç»“æŸã€‚

## ä¸å¾—ä¸è¯´çš„EventTarget.addEventListener()

åœ¨å†™addEventListener()çš„æ—¶å€™æˆ‘è¿˜æœ‰äº›çŠ¹è±«ï¼Œå‰ç¼€åº”è¯¥å†™ä»€ä¹ˆå‘¢ï¼ŸDOMElementï¼ŒDocumentï¼ŒWindowè²Œä¼¼éƒ½è¡Œã€‚çœ‹äº†MDNçš„å®šä¹‰ä¹‹åï¼Œæ‰çŸ¥é“åº”è¯¥æ˜¯`EventTarget`ã€‚

å¯ä»¥æ¥å“ä¸€ä¸‹MDNçš„å®šä¹‰ï¼š

> The EventTarget method addEventListener() sets up a function that will be called whenever the specified event is delivered to the target. `Common targets are Element, Document, and Window`, `but the target may be any object that supports events (such as XMLHttpRequest)`.

**è¿™é‡Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼š**é™¤äº†ä¸€äº›å¸¸è§çš„ä¾‹å¦‚`DOM Element`, `Document`, `Window`è¿™ç±»EventTargetå¯ä»¥ç»‘å®šäº‹ä»¶ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›"å¥‡æ€ªçš„ä¸œè¥¿"ä¹Ÿèƒ½ç»‘å®šï¼Œä¾‹å¦‚`XMLHttpRequest`ã€‚

### EventTarget.addEventListener()çš„å‚æ•°

ä¼—æ‰€å‘¨çŸ¥EventTarget.addEventListener()çš„å‰ä¸¤ä¸ªå‚æ•°æ˜¯åšä»€ä¹ˆçš„ï¼š

- type

  A case-sensitive string representing the event type to listen for.

  ä¸€ä¸ª`åŒºåˆ†å¤§å°å†™`çš„stringï¼Œæ ‡æ³¨ç›‘å¬çš„`ç±»å‹`

- listener

  This must be an object implementing the EventListener interface, or a JavaScript function. 

  å¿…é¡»æ˜¯ä¸€ä¸ªå®ç°äº†EventListeneræ¥å£çš„å¯¹è±¡æˆ–è€…æ˜¯ä¸€ä¸ªJSçš„å‡½æ•°ã€‚(è¿™é‡Œå®ç°ä¸€ä¸ªEventListeneræ¥å£çš„å¯¹è±¡è¿˜æŒºéº»çƒ¦çš„ğŸ¤¦â€â™‚ï¸ï¼Œæš‚æ—¶å¿½ç•¥å¯ä¸“æŠ½ä¸€æœŸç ”ç©¶)ã€‚æˆ‘ä»¬ä¸»è¦åœ¨æ—¥å¸¸å¼€å‘ä¸­ä½¿ç”¨çš„éƒ½æ˜¯ä¸€ä¸ªfunctionã€‚


å…¶å®æˆ‘ä¹‹å‰è¿˜è®°å¾—ç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯`useCapture`ä½†æ˜¯æˆ‘æ‰“å¼€ç°åœ¨çš„mdnå‘ç°ç¬¬ä¸‰ä¸ªå‚æ•°å·²ç»å˜æˆäº†optionsï¼Ÿï¼Ÿï¼Ÿï¼Ÿ

- options
  - capture:  Booleanï¼Œè¡¨ç¤º listener ä¼šåœ¨è¯¥ç±»å‹çš„äº‹ä»¶æ•è·é˜¶æ®µä¼ æ’­åˆ°è¯¥ EventTarget æ—¶è§¦å‘ã€‚
  - once:  Booleanï¼Œè¡¨ç¤º listener åœ¨æ·»åŠ ä¹‹åæœ€å¤šåªè°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœæ˜¯ trueï¼Œ listener ä¼šåœ¨å…¶è¢«è°ƒç”¨ä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚
  - passive: Booleanï¼Œè®¾ç½®ä¸ºtrueæ—¶ï¼Œè¡¨ç¤º listener æ°¸è¿œä¸ä¼šè°ƒ

## å…ˆæ¥è‡ªå·±éªŒè¯ä¸€ä¸‹æ•´ä¸ªäº‹ä»¶æµç¨‹

é¦–å…ˆæˆ‘ä»¬éœ€è¦æ„é€ ä¸€ä¸ª3å±‚çš„åµŒå¥—ç»“æ„ã€‚

```jsx
{% raw %}
function App() {
  return (
    <div className="bodyContainer">
      <div className="container1">
        <span className="tex1">Container 1</span>
        <div className="container2">
          <span className="tex1">Container 2</span>
          <div className="container3">
            <span className="tex1">Container 3</span>
          </div>
        </div>
      </div>
    </div>
  );
}
{% endraw %}
```

![](/assets/img/2021-03-26/initStructure.png)

åˆ†åˆ«ç»™æ¯ä¸ªå±‚çº§çš„divåŠ ä¸€ä¸ª`äº‹ä»¶ç›‘å¬`ã€‚

```jsx
{% raw %}
import React, { useCallback, useEffect } from 'react';
import './App.css';

function App() {
  const onContainerBodyClick = useCallback(() => {
    console.log('click in container')
  }, []);

  const onContainer1Click = useCallback(() => {
    console.log('click in container 1');
  }, []);

  const onContainer2Click = useCallback(() => {
    console.log('click in container 2');
  }, []);

  const onContainer3Click = useCallback(() => {
    console.log('click in container 3');
  }, []);

  useEffect(() => {
    const $ContainerBodyEle = document.getElementById('containerBody');
    const $Container1Ele = document.getElementById('container1');
    const $Container2Ele = document.getElementById('container2');
    const $Container3Ele = document.getElementById('container3');

    $ContainerBodyEle.addEventListener('click', onContainerBodyClick);
    $Container1Ele.addEventListener('click', onContainer1Click);
    $Container2Ele.addEventListener('click', onContainer2Click);
    $Container3Ele.addEventListener('click', onContainer3Click);

    return () => {
      $ContainerBodyEle.removeEventListener('click', onContainerBodyClick);
      $Container1Ele.removeEventListener('click', onContainer1Click);
      $Container2Ele.removeEventListener('click', onContainer2Click);
      $Container3Ele.removeEventListener('click', onContainer3Click);
    }
  }, [onContainerBodyClick, onContainer1Click, onContainer2Click, onContainer3Click]);


  return (
    <div id="containerBody" className="bodyContainer">
      <div id="container1" className="container1">
        <span className="tex1">Container 1</span>
        <div id="container2" className="container2">
          <span className="tex1">Container 2</span>
          <div id="container3" className="container3">
            <span className="tex1">Container 3</span>
          </div>
        </div>
      </div>
    </div>
  );
}

export default App;
{% endraw %}
```

ç‚¹å‡»æœ€å¤–å±‚

![](/assets/img/2021-03-26/clickContainerBody.gif)

ç‚¹å‡»Container1

![](/assets/img/2021-03-26/clickContainer1.gif)

ç‚¹å‡»Container2

![](/assets/img/2021-03-26/clickContainer2.gif)

ç‚¹å‡»Container3

![](/assets/img/2021-03-26/clickContainer3.gif)


**å› ä¸ºæ˜¯éªŒè¯æ‰€ä»¥æƒ³æŠŠè¿‡ç¨‹è´´çš„è¯¦ç»†ä¸€äº›ï¼Œå°±æŠŠæ¯æ¬¡çš„æˆªå›¾éƒ½è´´å‡ºæ¥äº†ã€‚**

å¯ä»¥çœ‹åˆ°å¦‚æœæŒ‰ç…§ä¹‹å‰æˆ‘ä»¬æ‰€è¯´çš„`å†’æ³¡æœºåˆ¶`ï¼Œæˆ‘ä»¬çš„è¾“å‡ºç»“æœæ˜¯å®Œå…¨ç¬¦åˆçš„ã€‚

![](/assets/img/2021-03-26/draw1.png)

### è¿™æ—¶å€™æˆ‘æƒ³çœ‹çœ‹optionsé‡Œçš„captureå±æ€§å’ŒuseCaptureæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

æˆ‘ä»¬åœ¨Container2ä¸Šåˆ†åˆ«è®¾ç½®ä¸‹`options: { capture: true }`å’Œ`useCapture: true`ã€‚

```js
$Container2Ele.addEventListener('click', onContainer2Click, { capture: true });

$Container2Ele.addEventListener('click', onContainer2Click, true);
```

å‘ç°æ‰“å°çš„ç»“æœéƒ½å¦‚ä¸‹

![](/assets/img/2021-03-26/capture.png)

æŸ¥çœ‹DOMçš„äº‹ä»¶ç›‘å¬å‘ç°æœ€ç»ˆéƒ½ä½“ç°ä¸ºè¿™ä¸ªæ ·å­

![](/assets/img/2021-03-26/checkCapture.png)

æ‰€ä»¥æˆ‘çš„ç»“è®ºæ˜¯ï¼Œoptionsä¸­çš„`captureå±æ€§`å’Œ`useCapture`é…ç½®çš„æ˜¯åŒä¸€ä¸ªåŠŸèƒ½ã€‚å°†`Container2`çš„äº‹ä»¶åœ¨æ•è·é˜¶æ®µå°±æ‰§è¡Œï¼Œæ‰€ä»¥æœ€å…ˆæ‰“å°çš„æ˜¯`click in container 2`ã€‚

![](/assets/img/2021-03-26/draw2.png)


# äºŒé¡¾ï¼šReactçš„Synthetic Event

åœ¨ä»‹ç»å®Œæœ€åŸºæœ¬çš„DOMçš„äº‹ä»¶æµå‘æœºåˆ¶ä¹‹åï¼Œæˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹Reactçš„äº‹ä»¶æœºåˆ¶ã€‚

é¦–å…ˆæˆ‘ä»¬å…ˆæŠŠä¹‹å‰çš„ä¾‹å­æ”¹æˆReactä¸­çš„äº‹ä»¶å†™æ³•

```jsx
{% raw %}
import React, { useCallback, useEffect } from 'react';
import './App.css';

function App() {
  const onContainerBodyClick =() => {
    console.log('react container')
  }

  const onContainer1Click = () => {
    console.log('react container 1');
  }

  const onContainer2Click = () => {
    console.log('react container 2');
  }

  const onContainer3Click =() => {
    console.log('react container 3');
  };

  return (
    <div id="containerBody" className="bodyContainer" onClick={onContainerBodyClick}>
      <div id="container1" className="container1" onClick={onContainer1Click}>
        <span className="tex1">Container 1</span>
        <div id="container2" className="container2" onClick={onContainer2Click}>
          <span className="tex1">Container 2</span>
          <div id="container3" className="container3" onClick={onContainer3Click}>
            <span className="tex1">Container 3</span>
          </div>
        </div>
      </div>
    </div>
  );
}

export default App;
{% endraw %}
```
ç„¶åç‚¹å‡»`Container 3`æ‰“å°ç»“æœå¦‚ä¸‹

![](/assets/img/2021-03-26/reactEvent.png)

æ•ˆæœå’ŒDOMçš„äº‹ä»¶æ‰“å°å‡ºæ¥`ä¸€æ‘¸ä¸€æ ·`ã€‚ä½†æ˜¯çœŸçš„æ˜¯ä¸€æ‘¸ä¸€æ ·å—ï¼Ÿï¼Ÿï¼Ÿ

è¿™ä¸ªæ—¶å€™æŠŠReactäº‹ä»¶å’ŒDOMäº‹ä»¶`åŒæ—¶ç»‘å®š`åˆ°å¯¹åº”çš„å…ƒç´ ä¸Šã€‚

![](/assets/img/2021-03-26/both.png)

**è¿™ä¸ªæ—¶å€™åŒºåˆ«ç¬é—´å°±å‡ºæ¥äº†ï¼**



`Reactçš„äº‹ä»¶`å…¨éƒ¨éƒ½æ˜¯`æ™šäºDOMäº‹ä»¶`çš„æ‰§è¡Œã€‚

ä¸ºä»€ä¹ˆReactçš„äº‹ä»¶å…¨éƒ¨éƒ½ä¼šæ™šäºDOMäº‹ä»¶çš„æ‰§è¡Œå‘¢ï¼Ÿ

## SyntheticEvent

`SyntheticEvent`æ˜¯ä¸€ä¸ª`ç±»`ï¼Œè¿™ä¸ªç±»å®ä¾‹å‡ºæ¥çš„å¯¹è±¡æ˜¯ä¸€ä¸ª`åˆæˆäº‹ä»¶`ï¼Œé¡¾åæ€ä¹‰`SyntheticEvent`æ˜¯æœ‰`åˆæˆä¹‹æ„`çš„ï¼Œä¸ºä»€ä¹ˆä¼šæœ‰åˆæˆçš„æ„æ€æˆ‘ä»¬éœ€è¦ä»Reactçš„äº‹ä»¶æœºåˆ¶æ¥èŠèµ·ã€‚

æˆ‘ä»¬éƒ½çŸ¥é“Reactä¼šæŠŠäº‹ä»¶ä»£ç†åˆ°`document`ä¸Š(< React v17.x)ï¼Œå¦‚å›¾

![](/assets/img/2021-03-26/react16EventConcept.png)

å…¶å®å¯ä»¥æ ¹æ®è¿™å¼ å›¾æŠŠReactçš„äº‹ä»¶æœºåˆ¶ç»Ÿä¸€æˆä¸€å¥è¯

**Reactæä¾›äº†ä¸€ç§â€œé¡¶å±‚æ³¨å†Œï¼Œäº‹ä»¶æ”¶é›†ï¼Œç»Ÿä¸€è§¦å‘â€çš„äº‹ä»¶æœºåˆ¶ã€‚**

## äº‹ä»¶ç»‘å®š

å…¶å®ä»”ç»†å…³æ³¨ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦‚ä½•æ³¨å†Œä¸€ä¸ª`Reactäº‹ä»¶çš„`

```jsx
{% raw %}
<div id="container1" className="container1" onClick={onContainer1Click}>
{% endraw %}
```

`onClick`å…¶å®æ˜¯ä¸€ä¸ª`prop`ï¼Œè€Œæˆ‘ä»¬çš„äº‹ä»¶å‡½æ•°`onContainer1Click`æ˜¯é€šè¿‡ä¼ å‚çš„æ–¹å¼ä¼ åˆ°äº†ç»„ä»¶(å…¶å®æ˜¯fiberèŠ‚ç‚¹ï¼Œä½†æ˜¯æˆ‘å¯¹fiberçš„äº†è§£å¾ˆå°‘ï¼Œæ‰€ä»¥è¿™é‡Œæ²¡åŠæ³•å±•å¼€è®²)ã€‚

`äº‹ä»¶æ³¨å†Œ`å…¶å®å°±æ˜¯å°†æˆ‘ä»¬åœ¨JSXä¸­æ‰€ç¼–å†™çš„äº‹ä»¶ç›¸å…³çš„æ“ä½œ`ç»‘å®š`åˆ°documentä¸Šçš„ä¸€ç§æ“ä½œã€‚

è€Œ`äº‹ä»¶ç»‘å®š`ä¸»è¦æ˜¯åœ¨åˆå§‹åŒ–DOMçš„äº‹ä»¶(å½“ç„¶DOMæ›´æ–°çš„æ—¶å€™ä¹Ÿä¼šæœ‰ï¼Œä½†æˆ‘ä»¬è¿™é‡Œä¸è®¨è®º)ã€‚åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè°ƒç”¨ä¸€ä¸ªæ–¹æ³•å«åš`setInitialDOMProperties()`

```ts
function setInitialDOMProperties(
  tag: string,
  domElement: Element,
  rootContainerElement: Element | Document,
  nextProps: Object,
  isCustomComponentTag: boolean,
): void {
  for (const propKey in nextProps) {
    if (!nextProps.hasOwnProperty(propKey)) {
      ...
    } else if (registrationNameDependencies.hasOwnProperty(propKey)) {
        // å¦‚æœpropKeyå±äºäº‹ä»¶ç±»å‹ï¼Œåˆ™è¿›è¡Œäº‹ä»¶ç»‘å®š
        ensureListeningTo(rootContainerElement, propKey, domElement);
      }
    }
  }
}
```
å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–¹æ³•ä¸­`registrationNameDependencies`ï¼Œè¿™é‡Œåˆ¤æ–­æŸä¸ª`propKey`æ˜¯å¦åœ¨`registrationNameDependencies`ä¸­ï¼Œ`registrationNameDependencies`æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå­˜å‚¨äº†æ‰€æœ‰Reactäº‹ä»¶å¯¹åº”çš„åŸç”ŸDOMäº‹ä»¶çš„é›†åˆã€‚

å¦‚æœæ˜¯äº‹ä»¶ç±»å‹çš„propï¼Œé‚£ä¹ˆå°†ä¼šè°ƒç”¨`ensureListeningTo()`å»ç»‘å®šäº‹ä»¶ã€‚
)

```js
function ensureListeningTo(rootContainerElement, registrationName, domElement) {
  const isDocumentOrFragment =
    rootContainerElement.nodeType === DOCUMENT_NODE ||
    rootContainerElement.nodeType === DOCUMENT_FRAGMENT_NODE
  const doc = isDocumentOrFragment
    ? rootContainerElement
    : rootContainerElement.ownerDocument
  listenTo(registrationName, doc)
}
```

å¯ä»¥ç®€å•çš„ç†è§£ä¸º`ensureListeningTo`å°±æ˜¯å»`å®Œæˆäº‹ä»¶ç»‘å®š`è¿™æ­¥æ“ä½œçš„ã€‚



## å®Œæˆç»‘å®šä¹‹åçš„ç›‘å¬

ç¬¬ä¸€æ­¥`ç»‘å®š`å®Œæˆä¹‹åï¼ŒæŠŠç»‘å®šåˆ°å¯¹åº”ä½ç½®çš„`ç›‘å¬å‡½æ•°`å«åš`listener`ã€‚ä½†è¿™ä¸ª`listener`å¹¶ä¸æ˜¯æˆ‘ä»¬åœ¨ç»„ä»¶é‡Œæ‰€å†™çš„é‚£ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯ä¸€ä¸ªé€šè¿‡`createEventListenerWrapperWithPriority()`åŒ…è£¹ç”Ÿæˆçš„å‡½æ•°ã€‚

åœ¨çœ‹è¿™ä¸ªè¿™ä¹ˆé•¿åå­—çš„å‡½æ•°å…¶å®å·²ç»æ˜ç™½è¿™ä¸ªå‡½æ•°æ˜¯åšä»€ä¹ˆçš„äº†ã€‚`åˆ›å»ºä¸€ä¸ªæœ‰ä¼˜å…ˆçº§eventListeneråŒ…è£¹å™¨`ã€‚

**å…¶å®`ä¸åŒçš„äº‹ä»¶`éƒ½æœ‰å„è‡ª`ä¸åŒçš„ä¼˜å…ˆçº§`ã€‚**

- `DiscreteEvent` ç¦»æ•£äº‹ä»¶. ä¾‹å¦‚blurã€focusã€ clickã€ submitã€ touchStart. è¿™äº›äº‹ä»¶éƒ½æ˜¯ç¦»æ•£è§¦å‘çš„

- `UserBlockingEvent` ç”¨æˆ·é˜»å¡äº‹ä»¶. ä¾‹å¦‚touchMoveã€mouseMoveã€scrollã€dragã€dragOverç­‰ç­‰ã€‚è¿™äº›äº‹ä»¶ä¼š'é˜»å¡'ç”¨æˆ·çš„äº¤äº’ã€‚


- `ContinuousEvent` å¯è¿ç»­äº‹ä»¶ã€‚ä¾‹å¦‚loadã€errorã€loadStartã€abortã€animationEnd. è¿™ä¸ªä¼˜å…ˆçº§æœ€é«˜ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒä»¬åº”è¯¥æ˜¯ç«‹å³åŒæ­¥æ‰§è¡Œçš„ï¼Œè¿™å°±æ˜¯Continuousçš„æ„ä¹‰ï¼Œå³å¯è¿ç»­çš„æ‰§è¡Œï¼Œä¸è¢«æ‰“æ–­.

### å€¼å¾—è¡¥å……

åˆ°ç°åœ¨ä½ç½®æˆ‘ä»¬é—æ¼äº†ä¸€ä¸ªçŸ¥è¯†ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬æ”¹æ€ä¹ˆ`åŒºåˆ†äº‹ä»¶æ‰§è¡Œé˜¶æ®µ`å‘¢ï¼Ÿ

åœ¨`äº‹ä»¶æ³¨å†Œ`(äº‹ä»¶ç»‘å®š)çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡åŒºåˆ†`onClick` or `onClickCapture`æ¥åŒºåˆ†æ˜¯åœ¨è¯¥äº‹ä»¶æ˜¯ä»¥`æ•è·é˜¶æ®µ`çš„é¡ºåºæ‰§è¡Œè¿˜æ˜¯`å†’æ³¡é˜¶æ®µ`çš„é¡ºåºæ‰§è¡Œã€‚

ä½†æ˜¯åˆ°äº†`çœŸæ­£æ‰§è¡Œäº‹ä»¶`çš„æ—¶å€™å‘¢ï¼Ÿæˆ‘ä»¬å·²ç»æŠŠå¯¹åº”çš„äº‹ä»¶å‡½æ•°é€šè¿‡`createEventListenerWrapperWithPriority()`åŒ…è£¹äº†ï¼Œå¹¶ä¸æ˜¯æˆ‘ä»¬æœ¬èº«çš„é‚£ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°äº†ã€‚

è¿™æ—¶å€™`createEventListenerWrapperWithPriority()`åŒ…è£¹å½¢æˆçš„å‡½æ•°æœ¬èº«æ¥å—ä¸€ä¸ªå‚æ•°`eventSystemFlags`ç”¨äºåŒºåˆ†ç³»ç»Ÿå„ä¸ªé˜¶æ®µã€‚

æ¯”å¦‚`eventSystemFlags`å…¶ä¸­ä¸€ä¸ªæ ‡è®°å«`IS_CAPTURE_PHASE`è¡¨æ˜äº†å½“å‰çš„äº‹ä»¶æ˜¯æ•è·é˜¶æ®µè§¦å‘ã€‚å½“äº‹ä»¶åå«æœ‰`Capture`åç¼€æ—¶ï¼Œ`eventSystemFlags`ä¼šè¢«èµ‹å€¼ä¸º`IS_CAPTURE_PHASE`ã€‚

å¯ä»¥çœ‹è¿™å¼ å›¾

![](/assets/img/2021-03-26/eventSystemFalges.png)

## æœ€åçš„äº‹ä»¶è§¦å‘

## å›åˆ°æˆ‘ä»¬çš„Demo

ç°





# ä¸‰é¡¾ï¼šä¸€äº›å€¼å¾—æ³¨æ„çš„ç‚¹





# å‚è€ƒ

- [EventTarget.addEventListener() - mdn](https://developer.mozilla.org/en-US/docs/Web/API/EventTarget/addEventListener)
- [SyntheticEvent](https://reactjs.org/docs/events.html#gatsby-focus-wrapper)
- [Handling Events](https://reactjs.org/docs/handling-events.html)
- [React ä¸­é˜»æ­¢äº‹ä»¶å†’æ³¡çš„é—®é¢˜](https://www.cnblogs.com/Wayou/p/react_event_issue.html)
- [æ·±å…¥ç†è§£Reactï¼šäº‹ä»¶æœºåˆ¶åŸç†](https://www.cnblogs.com/forcheng/p/13187388.html)
- [æ·±å…¥Reactåˆæˆäº‹ä»¶æœºåˆ¶åŸç†](https://segmentfault.com/a/1190000039108951)
- [äº‹ä»¶ç»‘å®š](https://react.jokcy.me/book/features/event-bind.html)